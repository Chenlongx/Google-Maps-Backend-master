<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ç”¨æˆ·ç™»å½•</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Arial', sans-serif;
            background-color: #f4f7fb;
            display: flex;
            justify-content: center;
            align-items: center;
            height: 100vh;
        }
        /* èƒŒæ™¯æ ·å¼ï¼šä¸º loading container è®¾ç½®èƒŒæ™¯ */
        .loading-container {
            display: flex;
            justify-content: center;
            align-items: center;
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.5);  /* åŠé€æ˜èƒŒæ™¯ */
            z-index: 9999;  /* ç¡®ä¿å®ƒä½äºé¡µé¢æœ€ä¸Šå±‚ */
            flex-direction: column;  /* å‚ç›´æ–¹å‘æ’åˆ— */
            color: white;
        }

        /* åŠ è½½ä¸­çš„æ–‡å­—æ ·å¼ */
        .loading-message {
            font-size: 20px;
            margin-bottom: 20px;
        }

        /* æ—‹è½¬åŠ¨ç”»çš„æ ·å¼ */
        .spinner {
            border: 8px solid #f3f3f3; /* è½»ç°è‰²èƒŒæ™¯ */
            border-top: 8px solid #3498db; /* æ·±è“è‰²çš„ä¸Šè¾¹æ¡† */
            border-radius: 50%;
            width: 50px;
            height: 50px;
            animation: spin 1s linear infinite; /* æ—‹è½¬åŠ¨ç”» */
        }

        /* æ—‹è½¬åŠ¨ç”»å…³é”®å¸§ */
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        .login-container {
            background-color: #fff;
            border-radius: 8px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
            width: 100%;
            max-width: 400px;
            padding: 30px;
            text-align: center;
        }

        h1 {
            color: #333;
            font-size: 26px;
            margin-bottom: 20px;
            font-weight: 600;
        }

        .login-container p {
            color: #555;
            font-size: 14px;
            margin-bottom: 30px;
        }

        .input-field {
            width: 100%;
            padding: 12px;
            margin: 10px 0;
            border: 1px solid #ddd;
            border-radius: 4px;
            font-size: 14px;
            transition: border-color 0.3s;
        }

        .input-field:focus {
            border-color: #4CAF50;
            outline: none;
        }

        .login-button {
            width: 100%;
            padding: 14px;
            background-color: #4CAF50;
            color: white;
            font-size: 16px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            transition: background-color 0.3s;
        }

        .login-button:hover {
            background-color: #45a049;
        }

        /* å¯†ç æ˜¾ç¤º/éšè—æŒ‰é’®æ ·å¼ */
        .input-container {
            position: relative;
        }
        .toggle-btn {
            position: absolute;
            right: 10px; /* è·ç¦»å®¹å™¨å³è¾¹10px */
            top: 50%; /* å‚ç›´å±…ä¸­ */
            transform: translateY(-50%); /* ä½¿æŒ‰é’®å®Œå…¨å±…ä¸­ */
            cursor: pointer;
            font-size: 18px;
            color: #777;
            transition: color 0.3s;
        }
        .toggle-btn:hover {
            color: #333;
        }
        .forgot-password {
            color: #4CAF50;
            font-size: 14px;
            text-decoration: none;
            margin-top: 20px;
            display: inline-block;
        }

        .forgot-password:hover {
            text-decoration: underline;
        }

    </style>
</head>
<body>
    <div class="login-container">
        <h1>ç”¨æˆ·ç™»å½•</h1>
        <p>è¯·è¾“å…¥æ‚¨çš„ç”¨æˆ·åå’Œå¯†ç è¿›è¡Œç™»å½•</p>

        <!-- ç™»å½•è¡¨å• -->
        <form id="loginForm">
            <input type="text" id="username" class="input-field" placeholder="ç”¨æˆ·å" required>
            <!-- å¯†ç è¾“å…¥æ¡†å’Œæ˜¾ç¤º/éšè—æŒ‰é’® -->
            <div class="input-container">
                <input type="password" id="password" class="input-field" placeholder="å¯†ç " required>
                <span id="togglePassword" class="toggle-btn">ğŸ‘ï¸</span>
            </div>
            <button type="submit" class="login-button">ç™»å½•</button>
        </form>

        <!-- å¿˜è®°å¯†ç é“¾æ¥ -->
        <a href="#" class="forgot-password" >å¿˜è®°å¯†ç ?</a>
    </div>
    <!-- åŠ è½½å®¹å™¨ -->
    <div class="loading-container" id="loadingContainer" style="display: none">
        <div class="loading-message">åŠ è½½ä¸­ï¼Œè¯·ç¨å€™...</div>
    </div>
    <script>
        // è·å–è¡¨å•å…ƒç´ 
        const loginForm = document.getElementById('loginForm');
        const usernameInput = document.getElementById('username');
        const passwordInput = document.getElementById('password');
        const loadingContainer = document.getElementById('loadingContainer');
        const togglePassword = document.getElementById('togglePassword');

        // åˆ‡æ¢å¯†ç æ˜¾ç¤º/éšè—
        togglePassword.addEventListener('click', function () {
            const type = passwordInput.type === 'password' ? 'text' : 'password';
            passwordInput.type = type;

            // åˆ‡æ¢å›¾æ ‡
            this.textContent = type === 'password' ? 'ğŸ‘ï¸' : 'ğŸ™ˆ';
        });

        // ç›‘å¬è¡¨å•æäº¤
        loginForm.addEventListener('submit', async (event) => {
            event.preventDefault(); // é˜²æ­¢è¡¨å•é»˜è®¤æäº¤è¡Œä¸º

            const username = usernameInput.value;
            const password = passwordInput.value;

            // æ£€æŸ¥ç”¨æˆ·åå’Œå¯†ç æ˜¯å¦ä¸ºç©º
            if (!username || !password) {
                alert("è¯·è¾“å…¥ç”¨æˆ·åå’Œå¯†ç ");
                return;
            }
            console.log(username, password);
            try {
                // æ˜¾ç¤ºåŠ è½½å™¨
                document.getElementById('loadingContainer').style.display = 'flex';

                // å‘èµ·ç™»å½•è¯·æ±‚
                const response = await fetch('/api/login', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({ username, password })
                });

                const data = await response.json();

                if (response.ok) {
                    // éšè—åŠ è½½å™¨
                    document.getElementById('loadingContainer').style.display = 'none';

                    // ç™»å½•æˆåŠŸ
                    // alert("ç™»å½•æˆåŠŸï¼");

                    // *** æ ¸å¿ƒä¿®æ”¹ï¼šå°† 'data.token' æ”¹ä¸º 'data.access_token' ***
                    localStorage.setItem('authToken', data.access_token);
                    console.log('authToken', data.access_token); // ä¹Ÿç›¸åº”ä¿®æ”¹è¿™é‡Œ

                    // æ ¹æ®è¿”å›çš„ç”¨æˆ·ä¿¡æ¯ï¼Œå¯ä»¥è¿›è¡Œè¿›ä¸€æ­¥æ“ä½œï¼Œæ¯”å¦‚è·³è½¬åˆ°ç®¡ç†é¡µé¢
                    console.log("ç”¨æˆ·ä¿¡æ¯:", data.user);
                    // è·³è½¬é¡µé¢
                    window.location.href = 'index.html';
                } else {
                    // ç™»å½•å¤±è´¥
                    alert(data.message || "ç™»å½•å¤±è´¥ï¼Œè¯·é‡è¯•");
                    document.getElementById('loadingContainer').style.display = 'none';
                }

            } catch (error) {
                // ç½‘ç»œé”™è¯¯æˆ–å…¶ä»–å¼‚å¸¸
                console.error("è¯·æ±‚å¤±è´¥:", error);
                alert("è¯·æ±‚å¤±è´¥ï¼Œè¯·ç¨åå†è¯•");
            }
        });


        // ç›‘å¬ "å¿˜è®°å¯†ç " é“¾æ¥çš„ç‚¹å‡»äº‹ä»¶
        document.querySelector('.forgot-password').addEventListener('click', function(event) {
            event.preventDefault();  // é˜²æ­¢é“¾æ¥çš„é»˜è®¤è·³è½¬è¡Œä¸º

            // å¼¹å‡ºè”ç³»ç®¡ç†å‘˜çš„ä¿¡æ¯
            alert('è¯·è”ç³»ç®¡ç†å‘˜è¿›è¡Œå¯†ç é‡ç½® \né‚®ç®±: aa2231401652@gmail.com');
        });
    </script>
</body>
</html>
